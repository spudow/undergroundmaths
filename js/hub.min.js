!function(){angular.module("cmHub",["cmCore"]).controller("HubController",["$scope","$timeout","$sce","$filter","$location","NewsItem","RecentUpdate","Event","FeaturedEvent","Article","ArticleType","Quote","Newsletter","Comment","Analytics","ResourceType","UsefulLink","UsefulDownload","Auth",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(a.viewModel={},a.viewModel.teamItemSelected="Directors",a.viewModel.activity={},a.viewModel.activity.recentDiscussionList=[],a.viewModel.activity.recentDiscussionRaw=[],a.viewModel.activity.topResourcesList=[],a.viewModel.activity.topCitiesList=[],a.viewModel.activity.total=null,a.viewModel.activity.resourceTypes=p.query(),a.updateRecentDiscussionList=function(){var c=[];a.viewModel.activity.recentDiscussionRaw.forEach(function(a){if(a.commentedItemInfo&&a.comment){var b={};c.push(b);var d=$("<div></div>").html(a.convertedContent).text();b.date=a.comment.createdDate,b.commentedItemUrl=a.commentedItemInfo.url,b.title=a.comment.title,b.commentedItemTitle=a.commentedItemInfo.title,b.content=d}}),a.viewModel.activity.recentDiscussionList=c,b(function(){cmSite.processContent()})},a.getRecentDiscussion=function(){n.queryRecent({maxRows:5},function(b){a.viewModel.activity.recentDiscussionRaw=b.results,a.updateRecentDiscussionList(),a.viewModel.activity.recentDiscussionLoaded||(a.scrollToInitialSection(),a.viewModel.activity.recentDiscussionLoaded=!0)},function(){a.viewModel.activity.recentDiscussionLoaded=!0})},a.getRecentDiscussion(),a.getTopResources=function(){o.queryResources(function(b){a.viewModel.activity.topResourcesList=b.slice(0,5),a.viewModel.activity.topResourcesLoaded||(a.scrollToInitialSection(),a.viewModel.activity.topResourcesLoaded=!0)},function(){a.viewModel.activity.topResourcesLoaded=!0})},a.getResourceAnalyticsDataUrl=function(a){return"/"+a.stationFriendlyId+"/"+a.friendlyName},a.getResourceAnalyticsDataResourceType=function(b){var c=a.viewModel.activity.resourceTypes.filter(function(a){return a.friendlyId==b.resourceType});return c.length>0?c[0]:null},a.secondsToHours=function(a){return a?a/3600:0},a.getTopResources(),a.getTopCities=function(){o.queryCities(function(b){a.viewModel.activity.topCitiesList=b.slice(0,5),a.viewModel.activity.topCitiesLoaded||(a.scrollToInitialSection(),a.viewModel.activity.topCitiesLoaded=!0)},function(){a.viewModel.activity.topCitiesLoaded=!0})},a.getTopCities(),a.getTotalAnalytics=function(){o.getTotal(function(b){a.viewModel.activity.total=b,a.viewModel.activity.totalLoaded||(a.scrollToInitialSection(),a.viewModel.activity.totalLoaded=!0)},function(){a.viewModel.activity.totalLoaded=!0})},a.getTotalAnalytics(),a.viewModel.newsItems={},a.viewModel.newsItems.pageSize=6,a.viewModel.newsItems.totalRows=0,a.viewModel.newsItems.currentPage=0,a.viewModel.newsItems.initalized=!1,a.viewModel.newsItems.detailList=[],a.viewModel.newsItems.getCurrentRow=function(){var b=a.viewModel.newsItems.pageSize||0;return(a.viewModel.newsItems.currentPage||0)*b},a.viewModel.newsItems.pageChange=function(){a.getNewsItems(),b(function(){a.scrollToSection("news")})},a.getNewsItems=function(){a.viewModel.newsItems.initialized=!0,f.queryConverted({startRow:a.viewModel.newsItems.getCurrentRow(),maxRows:a.viewModel.newsItems.pageSize},function(d){a.viewModel.newsItems.detailList=d.results,a.viewModel.newsItems.totalRows=d.totalRows,a.viewModel.newsItems.detailList.forEach(function(a){a.convertedContent=c.trustAsHtml(a.convertedContent)}),b(function(){cmSite.processContent()}),a.viewModel.newsItems.loaded||(a.scrollToInitialSection(),a.viewModel.newsItems.loaded=!0)},function(){a.viewModel.newsItems.loaded=!0})},a.viewModel.newsItems.initialized||a.getNewsItems(),a.viewModel.updates={},a.viewModel.updates.pageSize=12,a.viewModel.updates.totalRows=0,a.viewModel.updates.currentPage=0,a.viewModel.updates.initalized=!1,a.viewModel.updates.detailList=[],a.viewModel.updates.getCurrentRow=function(){var b=a.viewModel.updates.pageSize||0;return(a.viewModel.updates.currentPage||0)*b},a.viewModel.updates.pageChange=function(){a.getUpdates(),b(function(){a.scrollToSection("updates")})},a.getUpdates=function(){a.viewModel.updates.initialized=!0,g.queryDetail({startRow:a.viewModel.updates.getCurrentRow(),maxRows:a.viewModel.updates.pageSize},function(e){a.viewModel.updates.detailList=e.results,a.viewModel.updates.totalRows=e.totalRows,a.viewModel.updates.detailList.forEach(function(b){if(b.ownerInfo&&b.ownerInfo.htmlTitle){var e=$("<div></div>").html(b.ownerInfo.htmlTitle);e.find("a:first-child").after($('<span class="hub-update-item-meta"></span>').text(a.getUpdateTypeText(b)+" "+d("date")(b.recentUpdate.date,"dd-MMM-yy"))),b.ownerInfo.htmlTitle=c.trustAsHtml(e.html()),b.ownerInfo.description&&(b.ownerInfo.description=cmHelper.convertMarkdownToText(b.ownerInfo.description))}}),b(function(){cmSite.processContent()}),a.viewModel.updates.loaded||(a.scrollToInitialSection(),a.viewModel.updates.loaded=!0)},function(){a.viewModel.updates.loaded=!0})},a.getUpdateTypeText=function(a){var b="Added";return"Updated"==a.recentUpdate.updateType&&(b="Updated"),b},a.getUpdateDescription=function(a){var b=a.recentUpdate.description?a.recentUpdate.description:a.ownerInfo.description;return b||null},a.viewModel.updates.initialized||a.getUpdates(),a.viewModel.events={},a.viewModel.events.pageSize=6,a.viewModel.events.totalRows=0,a.viewModel.events.currentPage=0,a.viewModel.events.initalized=!1,a.viewModel.events.detailList=[],a.viewModel.events.getCurrentRow=function(){var b=a.viewModel.events.pageSize||0;return(a.viewModel.events.currentPage||0)*b},a.viewModel.events.pageChange=function(){a.getEvents(),b(function(){a.scrollToSection("events-main")})},a.getEvents=function(){a.viewModel.events.initialized=!0,h.queryConverted({startRow:a.viewModel.events.getCurrentRow(),maxRows:a.viewModel.events.pageSize},function(d){a.viewModel.events.detailList=d.results,a.viewModel.events.totalRows=d.totalRows,a.viewModel.events.detailList.forEach(function(a){a.convertedContent=c.trustAsHtml(a.convertedContent)}),b(function(){cmSite.processContent()}),a.viewModel.events.loaded||(a.scrollToInitialSection(),a.viewModel.events.loaded=!0)},function(){a.viewModel.events.loaded=!0})},a.viewModel.events.initialized||a.getEvents(),a.viewModel.featuredEvents={},a.viewModel.featuredEvents.getMoreButtonHtml=function(a){if(!a.moreButtonType||!a.moreButtonText||!a.moreButtonLink)return null;var b=null;return"SameTabLink"==a.moreButtonType?b=$('<a class="cm-button-primary"></a>').text(a.moreButtonText).attr("href",a.moreButtonLink):"NewTabLink"==a.moreButtonType&&(b=$('<a class="cm-button-primary"></a>').text(a.moreButtonText).attr("href",a.moreButtonLink).attr("target","_blank")),b?b[0].outerHTML:null},a.viewModel.featuredEvents.initalized=!1,a.viewModel.featuredEvents.detailList=[],a.getFeaturedEvents=function(){a.viewModel.featuredEvents.initialized=!0,i.queryConverted({startRow:0,maxRows:1},function(d){a.viewModel.featuredEvents.detailList=d.results,a.viewModel.featuredEvents.detailList.forEach(function(b){b.convertedContent=c.trustAsHtml(b.convertedContent),b.moreButtonHtml=a.viewModel.featuredEvents.getMoreButtonHtml(b.featuredEvent),b.moreButtonHtml&&(b.moreButtonHtml=c.trustAsHtml(b.moreButtonHtml))}),b(function(){cmSite.processContent()}),a.viewModel.featuredEvents.loaded||(a.scrollToInitialSection(),a.viewModel.featuredEvents.loaded=!0)},function(){a.viewModel.featuredEvents.loaded=!0})},a.viewModel.featuredEvents.initialized||a.getFeaturedEvents(),a.viewModel.articles={},a.viewModel.articles.pageSize=6,a.viewModel.articles.totalRows=0,a.viewModel.articles.currentPage=0,a.viewModel.articles.initalized=!1,a.viewModel.articles.detailList=[],a.viewModel.articles.articleTypeSelected=null,a.viewModel.articles.articleTypes=k.query(),a.viewModel.articles.getCurrentRow=function(){var b=a.viewModel.articles.pageSize||0;return(a.viewModel.articles.currentPage||0)*b},a.viewModel.articles.pageChange=function(){a.getArticles(),b(function(){a.scrollToSection("articles")})},a.getArticles=function(){a.viewModel.articles.initialized=!0,j.queryConverted({startRow:a.viewModel.articles.getCurrentRow(),maxRows:a.viewModel.articles.pageSize,type:a.viewModel.articles.articleTypeSelected},function(d){a.viewModel.articles.detailList=d.results,a.viewModel.articles.totalRows=d.totalRows,a.viewModel.articles.detailList.forEach(function(a){a.convertedContent=c.trustAsHtml(a.convertedContent)}),b(function(){cmSite.processContent()}),a.viewModel.articles.loaded||(a.scrollToInitialSection(),a.viewModel.articles.loaded=!0)},function(){a.viewModel.articles.loaded=!0})},a.$watch("viewModel.articles.articleTypeSelected",function(b,c){b!=c&&a.getArticles()}),a.viewModel.articles.initialized||a.getArticles(),a.viewModel.quotes={},a.viewModel.quotes.pageSize=9,a.viewModel.quotes.totalRows=0,a.viewModel.quotes.currentPage=0,a.viewModel.quotes.initalized=!1,a.viewModel.quotes.detailList=[],a.viewModel.quotes.getCurrentRow=function(){var b=a.viewModel.quotes.pageSize||0;return(a.viewModel.quotes.currentPage||0)*b},a.viewModel.quotes.pageChange=function(){a.getQuotes(),b(function(){a.scrollToSection("quotes")})},a.getQuotes=function(){a.viewModel.quotes.initialized=!0,l.queryPublic({startRow:a.viewModel.quotes.getCurrentRow(),maxRows:a.viewModel.quotes.pageSize},function(c){a.viewModel.quotes.detailList=c.results,a.viewModel.quotes.totalRows=c.totalRows,b(function(){cmSite.processContent()}),a.viewModel.quotes.loaded||(a.scrollToInitialSection(),a.viewModel.quotes.loaded=!0)},function(){a.viewModel.quotes.loaded=!0})},a.viewModel.quotes.initialized||a.getQuotes(),a.viewModel.newsletters={},a.viewModel.newsletters.pageSize=18,a.viewModel.newsletters.totalRows=0,a.viewModel.newsletters.currentPage=0,a.viewModel.newsletters.initalized=!1,a.viewModel.newsletters.detailList=[],a.viewModel.newsletters.getCurrentRow=function(){var b=a.viewModel.newsletters.pageSize||0;return(a.viewModel.newsletters.currentPage||0)*b},a.viewModel.newsletters.pageChange=function(){a.getNewsletters(),b(function(){a.scrollToSection("newsletters")})},a.getNewsletters=function(){a.viewModel.newsletters.initialized=!0,m.queryPublic({startRow:a.viewModel.newsletters.getCurrentRow(),maxRows:a.viewModel.newsletters.pageSize},function(b){a.viewModel.newsletters.detailList=b.results,a.viewModel.newsletters.totalRows=b.totalRows,a.viewModel.newsletters.loaded||(a.scrollToInitialSection(),a.viewModel.newsletters.loaded=!0)},function(){a.viewModel.newsletters.loaded=!0})},a.viewModel.newsletters.initialized||a.getNewsletters(),a.viewModel.usefulLinks={},a.viewModel.usefulLinks.pageSize=18,a.viewModel.usefulLinks.totalRows=0,a.viewModel.usefulLinks.currentPage=0,a.viewModel.usefulLinks.initalized=!1,a.viewModel.usefulLinks.detailList=[],a.viewModel.usefulLinks.getCurrentRow=function(){var b=a.viewModel.usefulLinks.pageSize||0;return(a.viewModel.usefulLinks.currentPage||0)*b},a.viewModel.usefulLinks.pageChange=function(){a.getUsefulLinks(),b(function(){a.scrollToSection("links")})},a.getUsefulLinks=function(){a.viewModel.usefulLinks.initialized=!0,q.query({startRow:a.viewModel.usefulLinks.getCurrentRow(),maxRows:a.viewModel.usefulLinks.pageSize},function(b){a.viewModel.usefulLinks.detailList=b.results,a.viewModel.usefulLinks.totalRows=b.totalRows,a.viewModel.usefulLinks.loaded||(a.scrollToInitialSection(),a.viewModel.usefulLinks.loaded=!0)},function(){a.viewModel.usefulLinks.loaded=!0})},a.viewModel.usefulLinks.initialized||a.getUsefulLinks(),a.viewModel.usefulDownloads={},a.viewModel.usefulDownloads.pageSize=18,a.viewModel.usefulDownloads.totalRows=0,a.viewModel.usefulDownloads.currentPage=0,a.viewModel.usefulDownloads.initalized=!1,a.viewModel.usefulDownloads.detailList=[],a.viewModel.usefulDownloads.getCurrentRow=function(){var b=a.viewModel.usefulDownloads.pageSize||0;return(a.viewModel.usefulDownloads.currentPage||0)*b},a.viewModel.usefulDownloads.pageChange=function(){a.getUsefulDownloads(),b(function(){a.scrollToSection("downloads")})},a.getUsefulDownloads=function(){a.viewModel.usefulDownloads.initialized=!0,r.query({startRow:a.viewModel.usefulDownloads.getCurrentRow(),maxRows:a.viewModel.usefulDownloads.pageSize},function(b){a.viewModel.usefulDownloads.detailList=b.results,a.viewModel.usefulDownloads.totalRows=b.totalRows,a.viewModel.usefulDownloads.loaded||(a.scrollToInitialSection(),a.viewModel.usefulDownloads.loaded=!0)},function(){a.viewModel.usefulDownloads.loaded=!0})},a.viewModel.usefulDownloads.initialized||a.getUsefulDownloads(),a.viewModel.scrolled=!1,a.scrollToSection=function(b,c){var d=$("#"+b);if(0!=d.length){var e=300;isNaN(c)||(e=c);var f=d.offset().top;"events-main"==b&&(f-=40),f<0&&(f=0),$("html, body").animate({scrollTop:f},e),a.viewModel.scrolled=!0}},a.scrollToInitialSection=function(){a.viewModel.initialSection&&b(function(){a.scrollToSection(a.viewModel.initialSection,a.viewModel.scrolled?0:300)})},sessionStorage["hub.initialSection"]){var t=null;try{t=JSON.parse(sessionStorage["hub.initialSection"])}catch(u){}t&&(a.viewModel.initialSection=t,a.scrollToInitialSection()),cmHelper.setSessionStorage("hub.initialSection",null)}}])}();