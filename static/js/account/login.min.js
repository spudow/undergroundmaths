!function(){angular.module("cmAccountLogin",["cmCore"]).controller("LoginController",["$scope","Auth","UserAccount",function(a,b,c){var d=cmHelper.getQueryStringParameters();if(a.currentUser.isLoggedIn())return void(d.message?location.href="/user?message="+d.message:location.href="/user");switch(a.viewModel={},a.viewModel.loginFormTemplate=cmHelper.templateBaseUrl+"/account/login-form.html",a.userLogin={},a.viewModel.errors=[],a.clearErrors=function(){a.viewModel.errors=[]},d.message){case"PasswordExpired":a.viewModel.message={text:"Your password has expired. Please reset it.",class:"cm-danger"};break;case"AccessDenied":case"LoginRequired":a.viewModel.message={text:"You must log in to view that page.",class:"cm-danger"};break;case"ResetPasswordSuccess":a.viewModel.message={text:"Your password has been reset and your new password emailed to you.",class:"cm-success"};break;case"ResetPasswordFailure":a.viewModel.message={text:"Your password could not be reset. You may not have a verified email address. Please contact the webmaster for help.",class:"cm-danger"};break;case"EmailVerificationSuccess":a.viewModel.message={text:"Your email address has been successfully verified.",class:"cm-success"};break;case"EmailVerificationFailure":a.viewModel.message={text:"Your email address was not verified. The verification code may have expired. Please try updating your email address again.",class:"cm-danger"};break;case"UnknownUser":a.viewModel.message={text:"Cannot find the specified user account. It may have expired if you did not validate your email address in time. If so, please register again.",class:"cm-danger"};break;case"AccountUpdated":a.viewModel.message={text:"Your account details were updated successfully.",class:"cm-success"};break;case"AccountDeleted":a.viewModel.message={text:"Your account was successfully deleted.",class:"cm-success"}}a.logIn=function(){a.clearErrors(),a.viewModel.loginForm.$valid&&c.logIn(a.userLogin,function(c){b.setCurrentUser(c),a.currentUser.passwordExpiryImminent()?location.href="/user/edit":!d.requestedUrl||"/"!=d.requestedUrl.substr(0,1)&&d.requestedUrl!=location.origin&&d.requestedUrl.substr(0,location.origin.length+1)!=location.origin+"/"?location.href="/user":location.href=decodeURIComponent(d.requestedUrl)},function(b){b.data&&b.data.errorMessages?a.viewModel.errors=b.data.errorMessages:a.viewModel.errors=["An error occured whilst trying to log in."],a.viewModel.loginForm.$setPristine(),a.viewModel.loginForm.$setUntouched(),a.userLogin.password=null})}}])}();